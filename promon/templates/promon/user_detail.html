{% extends "base.html" %}

{% block title %}People: {{ user_object.nice_name }}{% endblock title %}

{% block body %}
<div class="content project project-detail">
    <div class="page-header">
        <h1>{{ user_object.nice_name }} <small>{{ user_object.username }}</small></h1>
    </div>
    <div class="page-header">
    <div class="row">
        {% include "messages.html" %}
        <div class="span9">
            <form id="live-filter">
                <input id="project-search" type="text" autocomplete="off" />
                <span class="help-inline">Start Typing for Live Filtering of <strong>Projects and Tasks</strong></span>
            </form>
            <h2>Projects <small><a href="{% url project_create %}?next={{ request.next }}" class="colorize success">add new</a></small></h2>
            <table id="project-list" class="table table-striped table-bordered table-condensed">
                <thead>
                <tr>
                    <th class="blue">#</th>
                    <th class="blue">Name</th>
                    <th class="blue">Tech</th>
                    <th class="blue">Age</th>
                    <th class="blue">Tasks</th>
                    <th class="blue">Hours</th>
                    <th class="blue">% Done</th>
                    <th class="blue">Status</th>
                    <th>Edit</th>
                </tr>
                </thead>
                <tbody>
            {% for project in user_projects %}
                <tr class="project-row">
                    <td>{{ forloop.counter }}</td>
                    <td><a href="{% url project_detail project.pk %}">{{ project.name }}</a></td>
                    <td>{{ project.technology }}</td>
                    <td>{{ project.age }} days</td>
                    <td>{{ project.task_count }}</td>
                    <td>{{ project.task_hours }}</td>
                    <td>{{ project.completion_perc }} %</td>
                    <td>{{ project.status }} %</td>
                    <td><a class="label info" href="{% url project_update project.pk %}?next={{ request.path }}">Edit</a></td>
                </tr>
            {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="span3">
        <h3>Projects Summary</h3>
            <h2><small>Open Projects:</small> {{ user_open_projects|length }}</h2>
            <h2><small>Managed Tasks:</small> {{ user_open_projects.total_tasks }}</h2>
            <h2><small>Managed Hours:</small> {{ user_open_projects.total_task_hours }}</h2>
            <h2><small>Average Start Date:</small> {{ user_open_projects.avg_start_date|date:"N" }}</h2>
        </div>
    </div>
    </div>
    <div class="row">
        <div class="span9">
        <h2>Open Tasks <small><a href="{% url task_create %}?next={{ request.path }}" class="colorize success">add new</a></small></h2>
            <table id="task-list" class="table table-striped table-bordered table-condensed">
                <thead>
                <tr>
                    <th class="blue">#</th>
                    <th class="blue">Task</th>
                    <th class="blue">Project</th>
                    <th class="blue">Status</th>
                    <th class="blue">Due on</th>
                    <th class="blue">Hours</th>
                    <th>Edit</th>
                </tr>
                </thead>
                <tbody>
            {% for task in user_open_project_tasks %}
                <tr class="project-row">
                    <td>{{ forloop.counter }}</td>
                    <td><a href="{% url task_detail task.pk %}">{{ task.title }}</a></td>
                    <td><a href="{% url project_detail task.project.pk %}">{{ task.project.name|title }}</a></td>
                    <td>{{ task.status }}</td>
                    <td class="colorize {{ task.due_class }}">{{ task.due_dt|date:"D, n/j" }}</td>
                    <td>{{ task.task_time }}</td>
                    <td><a href="{% url task_update task.pk %}?next={{ request.path }}" class="label info">Edit</a></td>
                </tr>
            {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="span3">
        <h3>Tasks Summary</h3>
            <h3>Stuck</h3>
            <p>{{ project_tasks_stuck|length }} Tasks, {{ project_tasks_stuck_hours.total }} Hours</p>
            <h3>In Progress</h3>
            <p>{{ project_tasks_in_progress|length }} Tasks, {{ project_tasks_in_progress_hours.total }} Hours</p>
            <h3>Unstarted</h3>
            <p>{{ project_tasks_not_started|length }} Tasks, {{ project_tasks_not_started_hours.total }} Hours</p>
            <h3>Done</h3>
            <p>{{ project_tasks_done|length }} Tasks, {{ project_tasks_done_hours.total }} Hours</p>
        </div>
        <div class="span9">
        <h2>Done Tasks</h2>
            <table id="done-task-list" class="table table-striped table-bordered table-condensed">
                <thead>
                <tr>
                    <th class="green">#</th>
                    <th class="green">Task</th>
                    <th class="green">Project</th>
                    <th class="green">Status</th>
                    <th class="green">Done on</th>
                    <th class="green">Hours</th>
                    <th>Edit</th>
                </tr>
                </thead>
                <tbody>
            {% for task in user_done_project_tasks %}
                <tr class="project-row">
                    <td>{{ forloop.counter }}</td>
                    <td><a href="{% url task_detail task.pk %}">{{ task.title }}</a></td>
                    <td><a href="{% url project_detail task.project.pk %}">{{ task.project.name|title }}</a></td>
                    <td>{{ task.status }}</td>
                    <td>{{ task.due_dt|date:"D, n/j" }}</td>
                    <td>{{ task.task_time }}</td>
                    <td><a href="{% url task_update task.pk %}?next={{ request.path }}" class="label info">Edit</a></td>
                </tr>
            {% endfor %}
                </tbody>
            </table>
        </div>
        
    </div>
</div>
{% endblock body %}

{% block js %}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.tablesorter.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
        $(".table-striped").tablesorter({
            headers: { 5: { sorter: false}, 8: { sorter: false} }
        });
    
    $('tr.project-row').show();
    $('form#live-filter').on('keyup', '#project-search', function(e) {
        var tmpVAL = $('#project-search').val().toLowerCase();
        $('.project-row').each(function() {
          var tmpHTML = $(this).html().toLowerCase();
          if (tmpHTML.indexOf(tmpVAL) >= 0) {
            $(this).fadeIn(150);
          } else if (tmpVAL.length < 1) {
            $(this).fadeIn(150);
          } else {
            $(this).fadeOut(150);
          }
        });
    });
});
</script>
{% endblock js %}